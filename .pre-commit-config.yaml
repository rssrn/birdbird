repos:
  - repo: local
    hooks:
      - id: html-validate
        name: Validate HTML structure
        entry: npx html-validate
        language: system
        files: \.html$
        types: [file]
      - id: eslint
        name: Validate JavaScript
        entry: npx eslint --no-warn-ignored
        language: system
        files: \.(html|js)$
        types: [file]
      - id: stylelint
        name: Validate CSS
        entry: npx stylelint --allow-empty-input
        language: system
        files: \.(css|html)$
        types: [file]
      - id: cspell
        name: Spellcheck (British English)
        entry: npx cspell --no-progress --no-summary
        language: system
        files: \.(html|md)$
        types: [file]
      - id: a11y
        name: Runtime accessibility tests (pa11y)
        entry: bash -c 'PORT=$(python3 -c "import socket; s=socket.socket(); s.bind((\"\",0)); print(s.getsockname()[1]); s.close()"); npx serve -l $PORT src/birdbird/templates &>/dev/null & SERVER_PID=$!; sleep 2; PORT=$PORT npm run test:a11y; EXIT=$?; kill $SERVER_PID 2>/dev/null; exit $EXIT'
        language: system
        stages: [pre-push]
        pass_filenames: false
      - id: pip-audit
        name: Security audit (pip-audit)
        entry: .venv/bin/pip-audit --vulnerability-service osv --skip-editable
        language: system
        stages: [pre-push]
        pass_filenames: false
      - id: pytest-fast
        name: Run fast tests
        entry: .venv/bin/pytest -m "not slow"
        language: system
        pass_filenames: false
        types: [python]
      # TODO: Enable mypy hook after fixing type errors (see TODO.md)
      # - id: mypy
      #   name: Type check with mypy
      #   entry: .venv/bin/mypy src/birdbird
      #   language: system
      #   types: [python]
      #   pass_filenames: false
